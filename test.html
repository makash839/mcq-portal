<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>MCQ Test</title>

<style>
body{
  font-family: Arial;
  background:#f2f2f2;
}
.box{
  background:#fff;
  max-width:900px;
  margin:30px auto;
  padding:20px;
  box-shadow:0 0 10px rgba(0,0,0,.2);
}
.option{
  display:block;
  margin:8px 0;
}
button{
  padding:8px 15px;
  margin:5px;
}
.correct{border-left:5px solid green;padding:10px;margin:10px 0}
.wrong{border-left:5px solid red;padding:10px;margin:10px 0}
.skipped{border-left:5px solid orange;padding:10px;margin:10px 0}
#timer{
  font-weight:bold;
  color:red;
}
</style>
</head>

<body>

<div class="box" id="quizBox">
  <h3 id="qno"></h3>
  <p id="question"></p>
  <div id="options"></div>

  <p>‚è± Time Left: <span id="timer">60</span> sec</p>

  <button onclick="nextQuestion()">Next</button>
  <button onclick="skipQuestion()">Skip</button>
  <button onclick="finalSubmit()">Final Submit</button>
</div>

<div class="box" id="resultBox" style="display:none"></div>

<!-- SUBJECT FILES -->
<script src="data/history.js"></script>
<script src="data/polity.js"></script>
<script src="data/geography.js"></script>

<script>
// ================= SUBJECT SELECT =================
const params = new URLSearchParams(window.location.search);
const subject = params.get("subject");

let questions = [];
if(subject === "history") questions = historyQuestions;
else if(subject === "polity") questions = polityQuestions;
else if(subject === "geography") questions = geographyQuestions;
else {
  alert("Invalid subject");
}

// ================= VARIABLES =================
let index = 0;
let answers = [];
let correct = 0, wrong = 0, skipped = 0;

let timerInterval;
let timeLeft = 60;
let startTestTime = Date.now();

// ================= LOAD QUESTION =================
function loadQuestion(){
  clearInterval(timerInterval);
  timeLeft = 60;
  document.getElementById("timer").innerText = timeLeft;

  const q = questions[index];
  document.getElementById("qno").innerText =
    `Question ${index+1} / ${questions.length}`;
  document.getElementById("question").innerText = q.question;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.options.forEach((opt,i)=>{
    optDiv.innerHTML += `
      <label class="option">
        <input type="radio" name="opt" value="${i}">
        ${opt}
      </label>`;
  });

  window.qStartTime = Date.now();

  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").innerText = timeLeft;

    if(timeLeft <= 0){
      clearInterval(timerInterval);
      answers[index] = null; // ‚¨ÖÔ∏è unattempted
      index++;
      if(index < questions.length) loadQuestion();
      else finalSubmit();
    }
  },1000);
}

loadQuestion();

// ================= NEXT =================
function nextQuestion(){
  clearInterval(timerInterval);

  const selected = document.querySelector("input[name='opt']:checked");
  if(selected){
    answers[index] = parseInt(selected.value);
  } else {
    answers[index] = null;
  }

  index++;
  if(index < questions.length) loadQuestion();
  else finalSubmit();
}

// ================= SKIP =================
function skipQuestion(){
  clearInterval(timerInterval);
  answers[index] = null;
  index++;
  if(index < questions.length) loadQuestion();
  else finalSubmit();
}

// ================= FINAL SUBMIT =================
function finalSubmit(){
  clearInterval(timerInterval);
  document.getElementById("quizBox").style.display="none";
  const resBox = document.getElementById("resultBox");
  resBox.style.display="block";

  const totalSeconds = Math.floor((Date.now()-startTestTime)/1000);
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  const totalTimeText = minutes>0 ? `${minutes} min ${seconds} sec` : `${seconds} sec`;
  const avgTime = (totalSeconds/questions.length).toFixed(1);

  let reviewHTML = "";

  questions.forEach((q,i)=>{
    const ua = answers[i];
    const correctIndex = q.correct - 1; // ‚úÖ FIX (1‚Üí0 based)

    if(ua === null || ua === undefined){
      skipped++;
      reviewHTML += `
      <div class="skipped">
        <b>Q:</b> ${q.question}<br>
        <b>Status:</b> Skipped<br>
        <b>Correct:</b> ${q.options[correctIndex]}<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
    else if(ua === correctIndex){
      correct++;
      reviewHTML += `
      <div class="correct">
        <b>Q:</b> ${q.question}<br>
        <b>Status:</b> Correct<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
    else{
      wrong++;
      reviewHTML += `
      <div class="wrong">
        <b>Q:</b> ${q.question}<br>
        <b>Your:</b> ${q.options[ua]}<br>
        <b>Correct:</b> ${q.options[correctIndex]}<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
  });

  resBox.innerHTML = `
    <h2>üìä Final Result</h2>
    <p><b>Total Questions:</b> ${questions.length}</p>
    <p><b>Correct:</b> ${correct}</p>
    <p><b>Wrong:</b> ${wrong}</p>
    <p><b>Skipped:</b> ${skipped}</p>
    <p><b>Total Time:</b> ${totalTimeText}</p>
    <p><b>Average Time / Question:</b> ${avgTime} sec</p>
    <hr>
    <h3>Answer Review</h3>
    ${reviewHTML}
  `;
}
</script>

</body>
</html>
