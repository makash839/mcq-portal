<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>MCQ Test</title>

<style>
body{font-family:Arial;background:#f2f2f2}
.box{background:#fff;max-width:900px;margin:30px auto;padding:20px}
.option{display:block;margin:6px 0}
button{padding:8px 15px;margin:5px}
.correct{border-left:5px solid green;padding:10px}
.wrong{border-left:5px solid red;padding:10px}
.skipped{border-left:5px solid orange;padding:10px}
#timer{font-weight:bold;color:red}
</style>
</head>

<body>

<div class="box" id="quizBox">
  <h3 id="qno"></h3>
  <p id="question"></p>
  <div id="options"></div>
  <p>‚è± Time Left: <span id="timer">60</span> sec</p>

  <button onclick="nextQ()">Next</button>
  <button onclick="skipQ()">Skip</button>
  <button onclick="finalSubmit()">Final Submit</button>
</div>

<div class="box" id="resultBox" style="display:none"></div>

<!-- SUBJECT DATA -->
<script src="data/history.js"></script>
<script src="data/polity.js"></script>
<script src="data/geography.js"></script>

<script>
// ================= URL DATA =================
const url = new URLSearchParams(window.location.search);
const subject = url.get("subject");

let questions=[];
if(subject==="history") questions = historyQuestions;
else if(subject==="polity") questions = polityQuestions;
else if(subject==="geography") questions = geographyQuestions;
else alert("Invalid Subject");

// ================= VARIABLES =================
let i=0;
let answers = Array(questions.length).fill(null);
let correct=0, wrong=0, skipped=0;

let timer=60, timerInt;
let testStart = Date.now();
let qStart;

// ================= LOAD =================
function loadQ(){
  clearInterval(timerInt);
  timer=60;
  document.getElementById("timer").innerText=timer;

  const q=questions[i];
  document.getElementById("qno").innerText =
    `Question ${i+1}/${questions.length}`;
  document.getElementById("question").innerText=q.question;

  const opt=document.getElementById("options");
  opt.innerHTML="";
  q.options.forEach((o,idx)=>{
    opt.innerHTML+=`
      <label class="option">
        <input type="radio" name="opt" value="${idx}"> ${o}
      </label>`;
  });

  qStart = Date.now();

  timerInt=setInterval(()=>{
    timer--;
    document.getElementById("timer").innerText=timer;
    if(timer<=0){
      clearInterval(timerInt);
      i++;
      if(i<questions.length) loadQ();
      else finalSubmit();
    }
  },1000);
}
loadQ();

// ================= NEXT =================
function nextQ(){
  clearInterval(timerInt);
  const sel=document.querySelector("input[name='opt']:checked");
  answers[i]= sel ? parseInt(sel.value) : null;
  i++;
  if(i<questions.length) loadQ();
  else finalSubmit();
}

// ================= SKIP =================
function skipQ(){
  clearInterval(timerInt);
  answers[i]=null;
  i++;
  if(i<questions.length) loadQ();
  else finalSubmit();
}

// ================= FINAL =================
function finalSubmit(){
  clearInterval(timerInt);
  document.getElementById("quizBox").style.display="none";
  const res=document.getElementById("resultBox");
  res.style.display="block";

  let review="";
  questions.forEach((q,idx)=>{
    const realCorrect = q.correct - 1; // üî• FIX
    const ua = answers[idx];

    if(ua===null){
      skipped++;
      review+=`
      <div class="skipped">
        <b>Q:</b> ${q.question}<br>
        <b>Status:</b> Skipped<br>
        <b>Correct:</b> ${q.options[realCorrect]}<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
    else if(ua===realCorrect){
      correct++;
      review+=`
      <div class="correct">
        <b>Q:</b> ${q.question}<br>
        <b>Status:</b> Correct<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
    else{
      wrong++;
      review+=`
      <div class="wrong">
        <b>Q:</b> ${q.question}<br>
        <b>Your:</b> ${q.options[ua]}<br>
        <b>Correct:</b> ${q.options[realCorrect]}<br>
        <b>Explanation:</b> ${q.explanation}
      </div>`;
    }
  });

  const totalSec = Math.floor((Date.now()-testStart)/1000);
  const min = Math.floor(totalSec/60);
  const sec = totalSec%60;

  res.innerHTML=`
    <h2>üìä Final Result</h2>
    <p>Total: ${questions.length}</p>
    <p>‚úÖ Correct: ${correct}</p>
    <p>‚ùå Wrong: ${wrong}</p>
    <p>‚è≠ Skipped: ${skipped}</p>
    <p>‚è± Time: ${min} min ${sec} sec</p>
    <hr>
    <h3>Review</h3>
    ${review}
  `;
}
</script>

</body>
</html>
